# WhaleMoanViz
 modified from MAZ LabelViz for visualizing and editing WhaleMoanDetector annotations

Michaela Noel Alksne


WhaleMoanViz is a Triton Remora, based on LabelVis, designed to evaluate blue and fin whale call detections automatically generated by WhaleMoanDetector. 


  



Directions:


1. Load in the desired wav/xwav file and make a spectrogram with the same settings used to run the detector. 
* 10 -150 Hz frequency range
* 0.01 sec hop length (FFT=FS)
* 60 second window (this you can change however you want)


2. . If you haven’t already, add the WhaleMoanViz Remora to your Triton path by selecting “Add Remora” in Triton.


2. Once you’ve added the Remora, use the drop down menu to select “Visualize Labels” which will prompt you to select a .txt file that is WhaleMoanDetector’s predictions output. Select the desired file and the detections will load into Triton where they will be overlaid on the spectrogram and timeseries windows. The WhaleMoanViz GUI console looks like this:


  



Editing detections:


When you have loaded your detections, you have the option to edit their bounding box time-frequency coordinates, delete them (ie mark as false positive) or add new detections (false negative). 


Edit bounding box:


By simply clicking on the bounding box, it will turn blue and go into editing mode. Your MATLAB console will display a message that says “Interactive bounding box created.” You can drag the box around or expand or shrink it. When you are satisfied with your bounding box, press enter on your keyboard and your console will display a message saying “Enter key detected! Saving modified bounding box”.


Delete bounding box/mark as false positive: 


When a given detection is false positive, you can mark it by clicking on it and pressing delete or backspace on your keyboard. Once it has been marked as a false positive, it will turn pink. Your matlab console will display the message “Delete key detected! Marking as false positive”

False positive example below:


  



Add new bounding box:


If you see a call that was missed, you can add it by selecting the “Add Detection” button in the Remora’s GUI console. A message will appear saying “click and drag on the spectrogram to add a new detection.” Do that. Once you lift your mouse, a pop-up will appear over the spectrogram window with options for which call you want to label your detection as. Select the correct call type and click “Ok.” Example below:


  



Saving verified detections:


When you are satisfied with your evaluation of the detector, you can save the edited detections by clicking “Save Edits.” This will save a new .txt file to the same directory with the extension verified_detections.txt rather than raw_detections.txt. When you press save, the matlab console will display a message saying “Edits successfully saved to my_file_path\my_data_verified_detections.txt” This file will have a new column called “pr” which notes, for each detection, whether you marked it as true or false using these logical operators:


True positive = 1
False positive = 2
False negative = 3


You have the option to look through the whole audio file using the > button on the GUI console. Or, you can skip through the detections by clicking “next” or “previous.” 


Current bugs in WhaleMoanViz to be wary of:


1. There is no undo button. If you accidentally mark a detection as a false positive, you can’t undo it (unless you go into the global variable and do something tricky or reload the detections, ect). 
2. There is no “change label” button. So, for instance, if you see a 40 Hz marked as a D call, to re-label it, you’d have to delete the 40Hz and overlay a new detection that is a D call. Then, your future self can worry about how to evaluate this in your downstream performance statistics calculations. 
3. The call types are hard-coded (for now) so if you decide you want to label something other than an A, B, D, 20Hz, 40Hz, think again. 


The WhaleMoanViz evaluation GUI is still a work in progress and we are very open to feedback on how to make it better 🙂